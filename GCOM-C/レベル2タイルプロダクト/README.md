# GCOM-C.h5の処理(タイル)
### 取得項目：([詳しくは後述](#ActScript))
1. 指定範囲のcsvファイル[緯度、経度、特定のデータ]
2. 指定範囲の簡易的なpng画像(shpファイルがあれば、併記可能)
3. Point in Polygonを行ったcsvファイル[緯度、経度、特定のデータ]
4. ファイルのメタ(属性)データ

---
## 目次
1. [実行環境](#SetEnv)
2. [事前準備](#SetInit)
3. [実行・実行後の出力ファイル一覧](#ActScript)
4. [最後に．．．](#Final)




---
<a id="SetEnv"></a>

## 1. 実行環境

- Ubuntu == 20.04.3 LTS (Focal Fossa)
- python == 3.8.10
- instelled using pip
	- h5py
  	- numpy      == 1.19.5
  	- pandas     == 1.2.4
  	- geopandas  == 0.9.0
  	- matplotlib == 3.4.1
  	- shapely    == 1.7.1




---
<a id="SetInit"></a>

## 2. 事前準備
<a id="FolderTree"></a>

### はじめに : フォルダ構造
```
repositry ---- init.py
           |- Processing.py
           |- DATA?(これより深い階層はファイルパスが指定できればなんでもいいです)
           |- SHP --- GROUND --- Name.shp(ファイル名は自由，他の設定ファイルもここに置く)
           |       |- PIP    --- Area1(フォルダ名は自由) -- Name1.shp(ファイル名は自由, ※1)
           |                  |- Area2(フォルダ名は自由) -- Name2.shp(ファイル名は自由, ※1) 
           |                  |- 以降，複数設定可能
           |- OUTPUT(実行後作成される) --- CSV  --- 指定範囲内のcsv出力用フォルダ
                                       |- PNG  --- ROW --- 指定範囲内のpng出力用フォルダ
									   |        |- RGB --- RGB変換した散布図(点の大きさは別途調整する必要あり)
                                       |- PIP  --- データ種別1--- Area1(PIPで作成したフォルダ名) -- PIP(Area1)のcsv出力用フォルダ
                                       |        |             |- Area2(PIPで作成したフォルダ名) -- PIP(Area2)のcsv出力用フォルダ
                                       |        |             |- 以降，SHP/PIPで作成したフォルダの数だけ作成される
                                       |        |- データ種別2--- Area1(PIPで作成したフォルダ名) -- PIP(Area1)のcsv出力用フォルダ
                                       |        |             |- Area2(PIPで作成したフォルダ名) -- PIP(Area2)のcsv出力用フォルダ
                                       |        |             |- 以降，SHP/PIPで作成したフォルダの数だけ作成される
                                       |        |- 以降，hdf5ファイルに格納されているデータ分だけ出力される
                                       | 
                                       |- INFO --- ファイルにある属性情報の分だけフォルダが作成される(ファイル名で管理) 

※1 shpファイルを置くところには他の設定ファイルも置く
```

### 2.0. G-Poralからデータをダウンロードする   
登録は[こちら](https://gportal.jaxa.jp/gpr/?lang=ja)  
別レポジトリにダウンロード用スクリプトを公開する予定です．   

### 2.1. init.pyを編集し，条件を設定  
   ```
	〇 共通項目の設定
	start : 処理開始時間
	end   : 処理終了時間
	delta : 処理時間の間隔 ["H":時間, "D":日, "M":月] 時間は使わないかもしれないが。。  
	歯抜けしているファイルがあった場合はそのファイルをスルーして次のファイルに行きます
	⇒"File doesn't exists, yyyy/mm/dd"と出力されます
	
	〇 XLIM, YLIMの指定範囲内のデータを処理(CSV変換，図化)する
	YLIM = 緯度[最小, 最大値]を指定  
	XLIM = 経度[最小, 最大値]を指定  
	
	〇 図の設定
	Dflag : 図化するかしないかのフラグ
	　　　　 yes : 図化を含める(かなり時間がかかります)
			no  : 図化しない
	cmap = 図示時のカラーマップを指定(PNG/ROW)  
		Noneの場合は"rainbow"
		色のリストでも指定可能．例）["red", "blue", "green"]
	
	〇 データ種別の設定
	Element = ファイルから取得するデータ種別を指定  
	          ◆ すべてのデータを出力したい場合は["ALL"]とする
                  ⇒ 図化時はデータの最小・最大値からカラーバーが決まる
              ◆ 特定のデータを指定したい場合は，["データ種別", "VMIN", "VMAX"]とする
                  ⇒ 図化時はVMIN・VMAXからカラーバーが決まる
	
	〇　RGBの設定
	Rpath, Gpath, Bpath : [RGB散布図を作成するときのフォルダパス, バンド帯の最小値、バンド帯の最大値]
						　わからない・図化しない場合 ⇒ RGB散布図を作成するときのフォルダパスをNone
						  図化する場合は"Rs_VN03"など要素名を指定する
						  
						  バンド帯の最小値、最大値は適宜確認して設定しないといけない
						  ⇒単純にそのデータの最大値にするのではなく、ヒストグラム等でデータが密な部分を確認して設定すること

	〇　ファイル名パラメータの設定(時間はstart, end内の時間が入ります)
	Satelite   = "GC1"    # サテライト名
	Sensor     = "SG1"    # センサー
	A_D        = "A"      # 衛星進行方向 [A, D]のいずれか
	Ptu        = "01D"    # 統計データ日数("01D"：1日, "08D"：8日, "01M"：一月)
	Mapping    = "T"      # 投影法 [T:Tail]
	TileNoList = ["0729"] # タイル番号
	Level      = "L2"     # 処理レベル
	Type       = "SG"     # 処理プロダクト(ほぼ固定)
	ProductID  = "RSRF"   # プロダクトID
	Resolution = "Q"      # 分解能[K：1000m, Q:250m, F:1/24deg, C:1/12deg]
	AlgoVer    = "2"      # アルゴリズムバージョン
	ppp        = "000"    # パラメータバージョン
   ```
   
### 2.2. shpファイルの準備([フォルダ構造参照](#FolderTree))
#### 2.2.1. 図示時の背景図用shpファイル(任意)
SHP/GROUNDフォルダを作成し，図化に利用するshpファイルを<span style="color: red; ">一つだけ</span>置く
#### 2.2.2. PointInPolygon用(PIP)のshpファイル(任意)
SHP/PIPフォルダを作成し，PIPに利用するshpファイルを<span style="color: red; ">一つずつ</span>置く



---
<a id="ActScript"></a>

## 3. 実行・実行後の出力ファイル一覧
#### 0. 実行
```
python Processing.py
```

#### 1. OUTPUT/CSV  : 指定範囲のcsvファイル[緯度、経度、特定のデータ]
- XLIM, YLIMで設定した範囲内のデータが各hdf5ファイルごとにcsv出力される
- 欠損値：-999
#### 2. OUTPUT/PNG  : 指定範囲の簡易的なpng画像(shpファイルがあれば、併記可能)
- XLIM, YLIMで設定した範囲内のデータが各hdf5ファイルごとにpng出力される
- 欠損値：データの最小値と同じ色で出力(修正しないとなぁ．．)
		すべてが欠損値の場合：すべて99999で出力される
#### 3. OUTPUT/PIP  : Point in Polygonを行ったcsvファイル[緯度、経度、特定のデータ]
- shpファイルで指定された領域範囲内のデータが各hdf5ファイルごとにcsv出力される
- 欠損値：-999
#### 4. OUTPUT/INFO : ファイルのメタ(属性)データ
- 属性値の一般情報(作成者等)
- slopeやOffset等の各属性値の詳細情報
- QAflagやObsTime等のデータ一覧



---
<a id="Final"></a>

## 5. 最後に．．．
レポジトリのダウンロードやcloneをするのは自由ですが，責任や保証は一切しません．